all-versions:
- 1.0.0
- 1.0.1
- 1.1.0
- 1.2.0
author: Paul-Arthur Asselin
basic-deps:
  aeson: '>=2.0 && <2.3'
  base: '>=4.15.0.0 && <5'
  base64-bytestring: '>=1.0 && <1.3'
  bytestring: '>=0.10 && <0.13'
  claude: '>=0'
  containers: '>=0.6 && <0.8'
  filepath: '>=1.4 && <1.6'
  http-api-data: '>=0.4 && <0.7'
  http-client: '>=0.7 && <0.8'
  http-client-tls: '>=0.3 && <0.4'
  http-types: '>=0.12 && <0.13'
  servant: '>=0.19 && <0.21'
  servant-client: '>=0.19 && <0.21'
  text: '>=1.2 && <2.2'
  time: '>=1.9 && <1.15'
  vector: '>=0.12 && <0.14'
changelog: |
  1.2.0:

  - Add `Thinking` type with `ThinkingAdaptive` and `ThinkingEnabled` constructors
    - `thinking` field on `CreateMessage`
    - `ContentBlock_Thinking` and `ContentBlock_Redacted_Thinking` response blocks
    - `Content_Thinking` and `Content_Redacted_Thinking` for replaying thinking in multi-turn
    - `Delta_Thinking_Delta` and `Delta_Signature_Delta` for streaming
  - Add `Model_Context_Window_Exceeded` constructor to `StopReason`

  1.1.0:

  - Replace `output_format` with `output_config` on `CreateMessage` (breaking change)
    - New `OutputConfig` type with `effort` and `format` fields
    - `effortConfig` helper for effort-only configuration
    - `jsonSchemaConfig` helper for structured output configuration
  - Remove beta header requirement for structured outputs (now GA)

  1.0.1:

  - Add structured outputs support (beta feature `structured-outputs-2025-11-13`)
    - `OutputFormat` type and `jsonSchemaFormat` helper for JSON outputs
    - `output_format` field on `CreateMessage`
    - `strict` field on `Tool` and `strictFunctionTool` helper for strict tool validation
    - `additionalProperties` field on `InputSchema`
    - `Refusal` constructor for `StopReason`
  - Add `claude-structured-outputs-example`

  1.0.0:

  - Initial release
changelog-type: markdown
description: |
  # `claude`

  Haskell bindings to Anthropic's Claude API using `servant`.

  ## Example usage

  ```haskell
  {-# LANGUAGE DuplicateRecordFields #-}
  {-# LANGUAGE NamedFieldPuns        #-}
  {-# LANGUAGE OverloadedLists       #-}
  {-# LANGUAGE OverloadedStrings     #-}

  import Claude.V1
  import Claude.V1.Messages
  import Data.Foldable (traverse_)
  import qualified Data.Text as Text
  import qualified Data.Text.IO as Text.IO
  import qualified System.Environment as Environment

  main :: IO ()
  main = do
      key <- Environment.getEnv "ANTHROPIC_KEY"
      clientEnv <- getClientEnv "https://api.anthropic.com"
      let Methods{ createMessage } = makeMethods clientEnv (Text.pack key) (Just "2023-06-01")

      MessageResponse{ content } <- createMessage _CreateMessage
          { model = "claude-sonnet-4-5-20250929"
          , messages = [ Message{ role = User, content = [ textContent "Hello!" ] } ]
          , max_tokens = 1024
          }

      let display (ContentBlock_Text{ text }) = Text.IO.putStrLn text
          display _ = pure ()
      traverse_ display content
  ```

  ## Setup

  ### Using Nix with Flakes (Recommended)

  1. Ensure you have Nix with flakes enabled
  2. Copy the sample environment file:

  ```bash
  cp .envrc.sample .envrc
  ```

  3. Edit `.envrc` with your Anthropic API key
  4. Run `direnv allow`

  ### Manual Setup

  ```bash
  cabal build
  ```

  ## Environment Variables

  Set your Anthropic API key as an environment variable:

  ```bash
  # Option 1: Set directly in your shell
  export ANTHROPIC_KEY="your-anthropic-api-key"

  # Option 2: Using .envrc with direnv (recommended)
  cp .envrc.sample .envrc
  # Edit .envrc to add your API key
  direnv allow
  ```

  The API key is needed for running the test suite and example programs.

  ## Testing

  Run the test suite:

  ```bash
  cabal test
  ```

  ## Running the Examples

  See [examples](examples) for descriptions.

  ```bash
  cabal run claude-example
  cabal run claude-stream-example
  cabal run claude-tool-example
  cabal run claude-vision-example
  cabal run claude-tool-search-example
  cabal run claude-programmatic-tool-calling-example
  cabal run claude-structured-outputs-example
  ```

  ### Advanced Examples

  - **[Structured Outputs](https://platform.claude.com/docs/en/build-with-claude/structured-outputs)**: Constrain Claude's responses to follow a specific JSON schema, or validate tool parameters with strict mode

  The following examples require beta features:

  **Tool Search & Programmatic Tool Calling** (`advanced-tool-use-2025-11-20`):
  - **[Tool Search Tool](https://platform.claude.com/docs/en/agents-and-tools/tool-use/tool-search-tool)**: Server-side tool search for efficiently handling large numbers of tools
  - **[Programmatic Tool Calling (PTC)](https://platform.claude.com/docs/en/agents-and-tools/tool-use/programmatic-tool-calling)**: Claude writes and executes code to call multiple tools and aggregate results

  To enable beta features, use `makeMethodsWith` with the appropriate beta header:

  ```haskell
  let options = defaultClientOptions
          { apiKey = key
          , anthropicBeta = Just "advanced-tool-use-2025-11-20"
          }
  let Methods{ createMessage } = makeMethodsWith clientEnv options
  ```
description-type: markdown
hash: 35f0de42a29dfbcb3097978f5d674b08fd8eaf63c4ad1ad7fb3bda887bfd83da
homepage: ''
latest: 1.2.0
license-name: BSD-3-Clause
maintainer: pa@mercury.com
synopsis: Servant bindings to Anthropic's Claude API
test-bench-deps:
  aeson: '>=0'
  base: '>=0'
  claude: '>=0'
  http-client: '>=0'
  http-client-tls: '>=0'
  servant-client: '>=0'
  tasty: '>=0'
  tasty-hunit: '>=0'
  text: '>=0'
  vector: '>=0'
