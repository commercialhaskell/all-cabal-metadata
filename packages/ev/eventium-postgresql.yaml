all-versions:
- 0.1.0
author: ''
basic-deps:
  aeson: '>=1.5 && <2.3'
  base: '>=4.9 && <5'
  bytestring: '>=0.10 && <0.13'
  eventium-core: '>=0'
  eventium-sql-common: '>=0'
  mtl: '>=2.2 && <2.4'
  persistent: '>=2.13 && <2.15'
  text: '>=1.2 && <2.2'
changelog: ''
changelog-type: markdown
description: "# Eventium PostgreSQL\n\nPostgreSQL-based event store implementation
  for production event sourcing systems.\n\n## Overview\n\n`eventium-postgresql` provides
  a robust, production-ready event store implementation backed by PostgreSQL. It leverages
  PostgreSQL's ACID guarantees, indexing capabilities, and reliability for persistent
  event storage with high performance and data integrity.\n\n## Features\n\n- ✅ **ACID
  Transactions** - Full consistency guarantees\n- ✅ **Optimistic Concurrency** - Prevents
  lost updates with version checks\n- ✅ **Efficient Indexing** - Fast event retrieval
  by stream and position\n- ✅ **Global Event Ordering** - Sequence numbers for time-ordered
  queries\n- ✅ **Type-Safe Access** - Uses Persistent library for database operations\n-
  ✅ **Production Ready** - Battle-tested PostgreSQL backend\n- ✅ **Multi-Process Support**
  - Concurrent access from multiple applications\n\n## Database Schema\n\nThe implementation
  creates two main tables:\n- **Events Table** - Stores events with aggregate keys,
  versions, and payloads\n- **Global Events Table** - Maintains global ordering with
  sequence numbers\n\nIndexes ensure fast lookups by:\n- Stream key + version\n- Global
  sequence number\n- Event types (for projections)\n\n## Installation\n\nAdd to your
  `package.yaml`:\n\n```yaml\ndependencies:\n  - eventium-core\n  - eventium-sql-common\n
  \ - eventium-postgresql\n  - persistent-postgresql  # PostgreSQL driver\n```\n\n##
  Usage\n\n```haskell\nimport Eventium.Store.Postgresql\nimport Database.Persist.Postgresql\n\nmain
  :: IO ()\nmain = do\n  let connStr = \"host=localhost dbname=eventstore user=postgres\"\n
  \ \n  withPostgresqlPool connStr 10 $ \\pool -> do\n    -- Initialize schema\n    flip
  runSqlPool pool $ do\n      runMigration migrateAll\n      \n      -- Create event
  store\n      let store = makePostgresqlEventStore pool\n      \n      -- Use with
  command handlers\n      result <- applyCommandHandler \n        (eventStoreWriter
  store)\n        (eventStoreReader store)\n        commandHandler\n        aggregateId\n
  \       command\n```\n\n## Configuration\n\n### Connection String\n\n```haskell\n--
  Basic connection\n\"host=localhost port=5432 dbname=mydb user=myuser password=mypass\"\n\n--
  With connection pool\nwithPostgresqlPool connectionString poolSize $ \\pool -> ...\n```\n\n###
  Connection Pooling\n\nRecommended settings for production:\n```haskell\n-- Pool
  size based on concurrent requests\npoolSize = numCores * 2 + effectiveSpindleCount\n\n--
  Example: 10 connections for typical web app\nwithPostgresqlPool connStr 10 $ \\pool
  -> ...\n```\n\n## Setup\n\n### Start PostgreSQL with Docker\n\n```bash\n# Using
  docker-compose (provided in project root)\ndocker-compose up -d postgres\n\n# Or
  manually\ndocker run -d \\\n  --name eventium-postgres \\\n  -e POSTGRES_PASSWORD=postgres
  \\\n  -e POSTGRES_DB=eventstore \\\n  -p 5432:5432 \\\n  postgres:15\n```\n\n###
  Run Migrations\n\n```haskell\nrunSqlPool (runMigration migrateAll) pool\n```\n\n##
  Performance\n\nPostgreSQL provides excellent performance characteristics:\n- **Writes**:
  ~1000-5000 events/sec (single connection)\n- **Reads**: ~10000-50000 events/sec
  (with proper indexing)\n- **Scalability**: Read replicas for query scaling\n\nSee
  `postgres-event-store-bench/` for benchmarking scripts.\n\n## Best Practices\n\n1.
  **Use Connection Pooling** - Essential for web applications\n2. **Index Strategy**
  - Default indexes cover common queries\n3. **Backup Strategy** - Regular PostgreSQL
  backups\n4. **Monitoring** - Watch connection pool usage and query performance\n5.
  **Read Replicas** - Scale read models with PostgreSQL replication\n\n## Production
  Considerations\n\n- **High Availability** - Use PostgreSQL replication\n- **Backup
  & Recovery** - Point-in-time recovery with WAL archiving\n- **Monitoring** - Track
  event growth and query performance\n- **Connection Limits** - Configure max_connections
  appropriately\n\n## Example: Complete Setup\n\n```haskell\nimport Eventium.Store.Postgresql\nimport
  Control.Monad.Logger (runStdoutLoggingT)\n\nsetupEventStore :: IO ()\nsetupEventStore
  = runStdoutLoggingT $ do\n  let connStr = \"host=localhost dbname=eventstore\"\n
  \ \n  withPostgresqlPool connStr 10 $ \\pool -> do\n    -- Run migrations\n    flip
  runSqlPool pool $ runMigration migrateAll\n    \n    -- Event store is ready to
  use\n    liftIO $ putStrLn \"Event store initialized\"\n```\n\n## Documentation\n\n-
  [Main README](../README.md) - Project overview\n- [SQL Common](../eventium-sql-common/)
  - Shared SQL utilities\n- [Design Documentation](../DESIGN.md) - Architecture details\n\n##
  License\n\nMIT - see [LICENSE.md](LICENSE.md)\n"
description-type: markdown
hash: 19a2492ea38ee122c58d957b90d9e7e73c5c1d6c0f0265cc891dc795dc19f199
homepage: https://github.com/aleks-sidorenko/eventium#readme
latest: 0.1.0
license-name: MIT
maintainer: Alexander Sidorenko
synopsis: Postgres implementations for eventium
test-bench-deps:
  HUnit: '>=0'
  aeson: '>=1.5 && <2.3'
  base: '>=4.9 && <5'
  bytestring: '>=0.10 && <0.13'
  eventium-core: '>=0'
  eventium-sql-common: '>=0'
  eventium-test-helpers: '>=0'
  hspec: '>=0'
  mtl: '>=2.2 && <2.4'
  persistent: '>=2.13 && <2.15'
  persistent-postgresql: '>=0'
  text: '>=1.2 && <2.2'
  utf8-string: '>=0'
