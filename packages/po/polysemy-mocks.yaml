homepage: https://github.com/akshaymankar/polysemy-mocks#readme
changelog-type: markdown
hash: 4cd94a9728693f81f8832308c61a171d66096b38a3ba99d14ecc3fa13f418a27
test-bench-deps:
  base: '>=4.7 && <5'
  hspec: -any
  polysemy-mocks: -any
  polysemy: '>=1.7'
maintainer: itsakshaymankar@gmail.com
synopsis: Mocking framework for polysemy effects
changelog: |
  # Changelog for polysemy-mocks

  ## 0.3.0.0

  * Support template-haskell-2.17.0 (and so GHC 9.0)
  * Add 'HasCallStack' constraint to 'evalMocks', {run,eval,exec}Mock and default
    implementations for the "returns" functions (which throws error, by default).
    'RankNTypes' is now needed to use the TH mocks.

  ## 0.2.0.0

  * Support polysemy >= 1.7, drop support for older versions

  ## 0.1.0.1

  * Better docs

  ## 0.1.0.0

  * First release. Can mock effects.
basic-deps:
  base: '>=4.7 && <5'
  polysemy: '>=1.7'
  template-haskell: -any
all-versions:
- 0.1.0.0
- 0.1.0.1
- 0.2.0.0
- 0.3.0.0
author: Akshay Mankar
latest: 0.3.0.0
description-type: markdown
description: |
  # Polysemy Mocks

  ## Overview

  `polysemy-mocks` aims to provide a structure to write all mocks for polysemy and to generate those.

  ## Example

  ```haskell
  {-# LANGUAGE DataKinds #-}
  {-# LANGUAGE FlexibleContexts #-}
  {-# LANGUAGE FlexibleInstances #-}
  {-# LANGUAGE GADTs #-}
  {-# LANGUAGE LambdaCase #-}
  {-# LANGUAGE MultiParamTypeClasses #-}
  {-# LANGUAGE RankNTypes #-}
  {-# LANGUAGE ScopedTypeVariables #-}
  {-# LANGUAGE TemplateHaskell #-}
  {-# LANGUAGE TypeApplications #-}
  {-# LANGUAGE TypeFamilies #-}
  {-# LANGUAGE TypeOperators #-}

  module TeletypeSpec where

  import Data.Kind
  import Polysemy
  import Polysemy.Internal (send)
  import Test.Hspec
  import Test.Polysemy.Mock
  import Test.Polysemy.Mock.TH (genMock)
  import Prelude hiding (read)

  data Teletype (m :: Type -> Type) a where
    Read :: Teletype m String
    Write :: String -> Teletype m ()

  makeSem ''Teletype

  genMock ''Teletype

  program :: Member Teletype r => Sem r ()
  program = do
    write "Name: "
    name <- read
    write $ "Hello " <> name

  spec :: Spec
  spec =
    describe "program" $ do
      it "greets" $ runM @IO . evalMock $ do
        mockReadReturns (pure "Akshay")
        mock @Teletype @IO program
        writes <- mockWriteCalls
        embed $ writes `shouldBe` ["Name: ", "Hello Akshay"]
  ```
license-name: BSD-3-Clause
