homepage: https://docs.hercules-ci.com
changelog-type: markdown
hash: d1cf8aa226554f9ba9ac768b9c3382ffc26b4e8c6d066147d156315bb0269a01
test-bench-deps:
  exceptions: -any
  cnix: -any
  katip: -any
  bytestring: -any
  base: '>=4.7 && <5'
  hercules-ci-api-agent: -any
  hspec: -any
  text: -any
  hercules-ci-agent: -any
  safe-exceptions: -any
  monad-control: -any
  filepath: -any
  process: -any
  async: -any
  lifted-base: -any
  protolude: -any
  conduit: -any
  containers: -any
  unliftio-core: -any
  binary-conduit: -any
  binary: -any
  hercules-ci-api-core: -any
  lifted-async: -any
  transformers-base: -any
  attoparsec: -any
  optparse-applicative: -any
  aeson: -any
maintainer: info@hercules-ci.com
synopsis: Runs Continuous Integration tasks on your machines
changelog: "# Changelog\n\nAll notable changes to this project will be documented
  in this file.\n\nThe format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/)\nand
  this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).\n\n##
  [Unreleased]\n\n## [0.7.1] - 2020-06-17\n\n### Added\n\n - Push to any nix store,
  including S3, using the `NixCache` kind in `binary-caches.json`\n\n### Changed\n\n
  - Switch to Nixpkgs 20.03\n\n - Environment variables are now passed on to evaluation
  and build by default. This allows configuration to be passed to Nix without intervention
  from hercules-ci-agent.\n\n - `trusted-user` is not a requirement and is configured
  automatically when using the NixOS module or nix-darwin module.\n\n### Fixed\n\n
  - Agent will now reset its connection with hercules-ci.com when pings are not acknowledged
  in time.\n\n - Prevent running out of file descriptors by increasing the soft limit
  if possible.\n\n## [0.7.0] - 2020-05-05\n\n### Known issues\n\n - Agent process
  user must be in `trusted-users`. This is the case with the NixOS and nix-darwin
  module. Doing so is recommended for ease of use and performance but should not be
  a requirement.\n\n### Added\n\n - Jobs can be cancelled\n\n - Build logs are streamed
  in realtime\n\n - The build log now has timestamps and color\n\n - Distributed builds
  performance has improved by fetching fewer derivations\n\n### Fixed\n\n - Extra
  nix options were not passed to the build process\n\n## [0.6.6] - 2020-03-16\n\n###
  Fixed\n\n - NixOS, nix-darwin modules: check the `nix-daemon` source and add option
  to patch an in-memory cache expiry issue\n   causing errors in build clusters (of
  more than 1 machine). The module asks for confirmation.\n\n - **Manual action:**
  if you are not using the provided module and you run the agent on\n   more than
  one machine, and you use `nix-daemon`, to fix above issue, you need to:\n    - either
  upgrade your system's Nix to a recent `master` or version 2.4.0 when released,\n
  \   - or apply this patch to your system's Nix installation: https://github.com/NixOS/nix/pull/3405\n\n
  - Cachix: 0.3.5 -> [0.3.7](https://github.com/cachix/cachix/blob/master/cachix/CHANGELOG.md#037---2020-03-12)
  to prevent uploading bad NARs in rare cases.\n\n## [0.6.5] - 2020-03-07\n\n### Fixed\n\n
  - Work around a systemd behavior where it didn't restart the unit\n\n### Added\n\n
  - `--test-configuration` flag to validate the configuration without actually running
  the agent.\n\n## [0.6.4] - 2020-03-06\n\n### Fixed\n\n - Fix a bug blocking evaluation
  when a store path is removed from cache or cache configuration is changed.\n\n###
  Added\n\n - Cached builds to speed up `aarch64-linux` agent deployments.\n\n###
  [0.6.3] - 2020-02-19\n\n### Fixed\n\n - Fix a concurrency problem causing not all
  evaluation events to be written to server when evaluation fails.\n\n - Fix evaluation
  errors triggered by build outputs go missing from cache, by requesting a forced
  rebuild.\n\n - Fix blocked shutdown on NixOS, fix agent status in dashboard, by
  stopping agent before network shutdown #195.\n\n - Fix upload of large outputs by
  using the correct http client manager for Cachix, removing a timeout.\n\n### Changed\n\n
  - Agent will now try to verify that the nix-daemon has narinfo-cache-negative-ttl
  = 0. This is required for correct operation.\n\n### [0.6.2] - 2020-01-30\n\n###
  Fixed\n\n - Update cachix to support the API change for the new CDN. This update
  is\n   required for uploading sources and compressed outputs over 100MB in size.\n
  \  Please update.\n\n### [0.6.1] - 2019-11-06\n\n### Fixed\n\n - Fix token leak
  to system log when reporting an HTTP exception. This was introduced by a library
  upgrade.\n   This was discovered after tagging 0.6.0 but before the release was\n
  \  announced and before moving of the `stable` branch.\n   Only users of the `hercules-ci-agent`
  `master` branch and the unannounced\n   tag were exposed to this leak.\n   We recommend
  to follow the `stable` branch.\n\n - Temporarily revert a Nix GC configuration change
  that might cause problems\n   until agent gc root behavior is improved.\n\n### [0.6.0]
  - 2019-11-04\n\n### Changed\n\n - Switch to Nix 2.3 and NixOS 19.09. *You should
  update your deployment to reflect the NixOS upgrade*, unless you're using terraform
  or nix-darwin, where it's automatic.\n - Increased parallellism during push to cachix\n
  - Switch to NixOS 19.09\n - Enable min-free/max-free Nix GC\n\n### Fixed\n\n - Transient
  errors during source code fetching are now retried\n - Fixed a bug related to narinfo
  caching in the context of IFD\n - Fixed an exception when the root of ci.nix is
  a list, although lists are unsupported\n\n## [0.5.0] - 2019-10-01\n\n### Added\n\n-
  Now deployable with [terraform-hercules-ci](https://github.com/hercules-ci/terraform-hercules-ci)\n\n###
  Changed\n\n- The `binary-caches.json` file can now be deployed like any other confidential
  file. Its contents are not required at module evaluation time any more.\n\n- The
  `services.hercules-ci-agent.binaryCachesFile` option has been removed.\n\n  **NixOps
  users**: rename to `deployment.keys.\"binary-caches.json\".file`\n\n  **Others**:
  remove your `binaryCachesFile` value. Make sure `binary-caches.json` is deployed.\n\n-
  The `binary-caches.json` file is now required. The empty object `{}` is a\n  valid
  file, but we highly recommend to configure a cache.\n\n\n### Fixed\n\n - The agent
  will now actually auto-restart when the secrets files change.\n\n\n## [0.4.0] -
  2019-08-30\n\n### Added\n\n- Support for import-from-derivation. See https://blog.hercules-ci.com/2019/08/30/native-support-for-import-for-derivation/
  for details.\n\n### Changed\n\n\n- Report build failures and technical errors (misconfigurations,
  etc) separately\n\n- Remove HerculesScribe\n\n- Worker now uses structured logging
  (including worker pid, etc)\n\n### Fixed\n\n- Disable parallel GHC GC to improve
  runtime performance\n\n- Bump Cachix to fix a few bugs (errors with too many derivations,
  performance fixes, etc.)\n\n - Modern BoehmGC initial settings for Nix memory limits
  \n\n## [0.3.2] - 2019-08-11\n\n### Fixed\n\n- Deploying the agent from different
  system (darwin to linux) resulted into\n  using the wrong executable\n\n\n## [0.3.1]
  - 2019-08-07\n\n### Changed\n\n- Emit a log when evaluator starts to push to cachix\n\n-
  Increase attribute limit to 50k\n\n- Pin nixpkgs commit and speed up compilation
  via https://hercules-ci.cachix.org\n\n\n### Fixed\n\n- Possible exception during
  evaluation was not propagated,\n  resulting into lack of retries\n\n- #8: Refresh
  agent session on cluster join token change\n\n- Fix segfault on involved IFD project
  (remove a finalizer)\n\n- Cachix: fix a crash with a lot of attributes (when determining
  closure graph)\n\n## [0.3.0] - 2019-07-05\n\n### Changed\n\n- Configuration of the
  agent is now done via `--config agent.toml`\n  so all command line arguments were
  removed.\n\n  See https://docs.hercules-ci.com/#agent-configuration-file\n\n- NixOS-based
  deployments now require `enable`.\n\n      services.hercules-ci-agent.enable = true;\n\n-
  All files are placed/expected in new locations that by default derive\n  from the
  `baseDirectory` option in the `agent.toml` file.\n\n  You may remove `~/.hercules-ci-agent`
  and `~/.local/share/hercules-ci-agent` after upgrading.\n\n### Fixed\n\n- Added
  retries to status reporting to fix potential\n  inconsistencies on the service\n\n###
  Added\n\n- Added Cachix support, for multi-agent and multi-platform support\n\n-
  Report derivation outputs with their size and hashes\n\n- Added Darwin support via
  nix-darwin\n\n- Support `requiredFeatures` attribute on derivations\n\n- Hello and
  hearthbeat protocol, which will allow the\n  service to be aware of how the agent
  is configured and\n  when it's online.\n\n## [0.2] - 2019-05-14\n\n- use [gitignore]
  instead of [nix-gitignore]\n- fix build on Darwin\n- limit internal concurrency
  to max eight OS threads for beefier machines\n- show version on `--help`\n- build
  against NixOS 19.03 as default\n- propagate agent information to agent view: Nix
  version, substituters,\n  platform and Nix features\n\n## [0.1.1] - 2019-04-16\n\n###
  Added\n\n- Support ci.nix or nix/ci.nix along with default.nix\n\n## [0.1.0.0] -
  2019-03-28\n\n- Initial release\n\n[0.6.6]: https://github.com/hercules-ci/hercules-ci-agent/compare/hercules-ci-agent-0.6.4...hercules-ci-agent-0.6.6\n[0.6.5]:
  https://github.com/hercules-ci/hercules-ci-agent/compare/hercules-ci-agent-0.6.3...hercules-ci-agent-0.6.5\n[0.6.4]:
  https://github.com/hercules-ci/hercules-ci-agent/compare/hercules-ci-agent-0.6.3...hercules-ci-agent-0.6.4\n[0.6.3]:
  https://github.com/hercules-ci/hercules-ci-agent/compare/hercules-ci-agent-0.6.2...hercules-ci-agent-0.6.3\n[0.6.2]:
  https://github.com/hercules-ci/hercules-ci-agent/compare/hercules-ci-agent-0.6.1...hercules-ci-agent-0.6.2\n[0.6.1]:
  https://github.com/hercules-ci/hercules-ci-agent/compare/hercules-ci-agent-0.6.0...hercules-ci-agent-0.6.1\n[0.6.0]:
  https://github.com/hercules-ci/hercules-ci-agent/compare/hercules-ci-agent-0.5.0...hercules-ci-agent-0.6.0\n[0.5.0]:
  https://github.com/hercules-ci/hercules-ci-agent/compare/hercules-ci-agent-0.4.0...hercules-ci-agent-0.5.0\n[0.4.0]:
  https://github.com/hercules-ci/hercules-ci-agent/compare/hercules-ci-agent-0.3.2...hercules-ci-agent-0.4.0\n[0.3.2]:
  https://github.com/hercules-ci/hercules-ci-agent/compare/hercules-ci-agent-0.3.1...hercules-ci-agent-0.3.2\n[0.3.1]:
  https://github.com/hercules-ci/hercules-ci-agent/compare/hercules-ci-agent-0.3.0...hercules-ci-agent-0.3.1\n[0.3.0]:
  https://github.com/hercules-ci/hercules-ci-agent/compare/hercules-ci-agent-0.2...hercules-ci-agent-0.3.0\n[0.2]:
  https://github.com/hercules-ci/hercules-ci-agent/compare/hercules-ci-agent-0.1.1...hercules-ci-agent-0.2\n[0.1.1]:
  https://github.com/hercules-ci/hercules-ci-agent/compare/hercules-ci-agent-0.1.0.0...hercules-ci-agent-0.1.1\n[Unreleased]:
  https://github.com/hercules-ci/hercules-ci-agent/compare/stable...master\n[nix-gitignore]:
  https://github.com/siers/nix-gitignore\n[gitignore]: https://github.com/hercules-ci/gitignore\n"
basic-deps:
  http-client: -any
  exceptions: -any
  cnix: -any
  katip: -any
  bytestring: -any
  lens-aeson: -any
  inline-c: -any
  hostname: -any
  unliftio: -any
  unix: -any
  stm: -any
  base: '>=4.7 && <5'
  time: -any
  cachix-api: -any
  hercules-ci-api-agent: ==0.2.1.0
  base64-bytestring: -any
  servant-client: -any
  unordered-containers: -any
  text: -any
  uuid: -any
  hercules-ci-agent: -any
  servant-auth-client: -any
  cachix: -any
  safe-exceptions: -any
  internal-ffi: -any
  servant-client-core: -any
  unbounded-delays: -any
  monad-control: -any
  filepath: -any
  process: -any
  network: -any
  async: -any
  websockets: -any
  lifted-base: -any
  dlist: -any
  protolude: -any
  conduit: -any
  inline-c-cpp: -any
  servant: '>=0.14.1'
  conduit-extra: -any
  containers: -any
  lens: -any
  unliftio-core: -any
  binary-conduit: -any
  binary: -any
  hercules-ci-api-core: ==0.1.1.0
  http-client-tls: -any
  wuss: -any
  network-uri: -any
  mtl: -any
  lifted-async: -any
  transformers-base: -any
  attoparsec: -any
  transformers: -any
  temporary: -any
  optparse-applicative: -any
  http-conduit: -any
  aeson: -any
  vector: -any
  tomland: '>=1.0.1.0'
  directory: -any
all-versions:
- 0.7.1
author: Hercules CI contributors
latest: 0.7.1
description-type: haddock
description: ''
license-name: Apache-2.0
