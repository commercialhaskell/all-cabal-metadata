all-versions:
- '0.1'
- 0.1.1
- 0.1.1.1
- 0.1.1.2
- 0.1.2
- '0.2'
- 0.2.0.1
- '0.3'
- '0.4'
- 0.4.1
- 0.4.1.1
- 0.4.1.2
- 0.4.2
- 0.4.2.1
- 0.4.2.2
- 0.4.2.4
- 0.4.3.0
- 0.4.4.0
- 0.4.5.0
- 0.4.6.0
- 0.4.6.1
- '0.5'
- 0.5.0.1
- 0.5.0.2
- 0.5.0.3
- '0.6'
- 0.6.1
- 0.6.2
- 0.6.3
author: Joachim Breitner
basic-deps:
  base: '>=4.9 && <4.23'
  containers: '>=0'
  ghc: '>=8.0.2 && <9.15'
  template-haskell: '>=0'
  transformers: '>=0'
changelog: "# Revision history for inspection-testing\r\n\r\n## 0.6.3 -- 2026-01-17\r\n\r\n*
  Compatibility with GHC 9.14\r\n* Remove spurious mtl dependency\r\n\r\n## 0.6.2
  -- 2025-06-13\r\n\r\n* Fix an bug that would cause a GHC panic\r\n* Fix `=/~` and
  `=/-` \r\n* Syntax directed comparison of lets\r\n\r\n(all thanks Oleg Grenrus)\r\n\r\n##
  0.6.1 -- 2025-06-11\r\n\r\n* Improve presentation of term inequalities (thanks Oleg
  Grenrus)\r\n\r\n## 0.6 -- 2025-01-01\r\n\r\n* Support GHC 9.10.1 (thanks Andre Van
  Der Merwe)\r\n* Support GHC 9.12 (thanks Erik de Castro Lopo)\r\n* Ignore SourceNote
  tick (thanks Potato Hatsue)\r\n\r\n## 0.5.0.3 -- 2023-12-29\r\n\r\n* Support GHC
  9.10 (thanks Bodigrim)\r\n\r\n## 0.5.0.2 -- 2023-07-10\r\n\r\n* Support GHC 9.8
  (thanks Bodigrim)\r\n\r\n## 0.5.0.1 -- 2023-01-15\r\n\r\n* Support mtl-2.3 and GHC
  9.6 (thanks Bodigrim)\r\n\r\n## 0.5 -- 2022-06-15\r\n\r\n* New equivalence `==~`
  that accepts different order of bindings in lets. (thanks @phadej)\r\n* When printing
  terms that differ, common up a common prefix of lambdas (thanks @phadej)\r\n\r\n##
  0.4.6.1 -- 2022-05-20\r\n\r\n* Support GHC 9.4 (thanks @parsonsmatt)\r\n\r\n## 0.4.6.0
  -- 2020-08-23\r\n\r\n* Support GHC 9.2 (thanks @Bodigrim)\r\n\r\n## 0.4.5.0 -- 2020-04-28\r\n\r\n*
  Export some internals from `Test.Inspection.Plugin`, to make integration into\r\n
  \ testing frameworks easier (thanks @Bodigrim)\r\n\r\n## 0.4.4.0 -- 2020-04-21\r\n\r\n*
  More GHC-9.0 compatibility (thanks @aadaa-fgtaa)\r\n\r\n## 0.4.3.0 -- 2020-01-26\r\n\r\n*
  Ignores HPC ticks in `(==-)` (thanks @konn)\r\n* Add `(=/-)` operator (thanks @lysxia)\r\n*
  Add skip-O0 plugin option (thanks @AndrasKovacs)\r\n* GHC-9.0 compatibility (thanks
  @konn)\r\n* CI now runs on Github Actions (thanks @phadej)\r\n\r\n## 0.4.2.4 --
  2020-01-26\r\n\r\n* Now prints the name of the type class on which a test fails,
  thanks to\r\n  Harendra Kumar\r\n* More examples, thanks to Rafe\r\n\r\n## 0.4.2.3
  -- 2020-01-26\r\n\r\n* Support GHC-8.10, thanks to Ryan Scott via head.hackage for
  the patch\r\n\r\n## 0.4.2.1 -- 2019-06-07\r\n\r\n* Bugfix release\r\n\r\n## 0.4.2
  -- 2019-06-05\r\n\r\n* Be less picky if mutually recursive definitions appear in
  a different order\r\n  in the source\r\n* Add obligation `coreOf`, which succeeds,
  but lets you dump the core of a\r\n  single symbol (thanks to @phadej)\r\n* Support
  `-fplugin-opt=Test.Inspection.Plugin:keep-going-O0` (thanks to @phadej)\r\n\r\n##
  0.4.1.2 -- 2019-02-23\r\n\r\n* Do not force recompilation with GHC >= 8.6\r\n* Support
  `-fplugin-opt=Test.Inspection.Plugin:quiet`\r\n\r\n## 0.4.1.1 -- 2018-11-17\r\n\r\n*
  Fix a bug with `doesNotUse` and data constructors\r\n\r\n## 0.4.1 -- 2018-11-17\r\n\r\n*
  New obligation `doesNotUse`\r\n* Use the Obligationâ€™s testName in the plugin output.\r\n*
  In `inspect`, do not override `srcLoc` if already present.\r\n\r\n## 0.4 -- 2018-10-12\r\n\r\n*
  Support GHC-8.6\r\n* On GHC-8.4 or newer, `inspect` and `inspectTest` will automatically
  load the\r\n  plugin.\r\n\r\n## 0.3 -- 2018-07-07\r\n\r\n* On GHC-8.5 or newer,
  use of `inspect` or `inspectTest` without actually\r\n  loading the plugin will
  cause compilation to fail at type-checking time\r\n  (thanks to @adamgundry for
  the idea)\r\n* Support for `hasNoTypeClass` (thanks to @phadej)\r\n* Support for
  `hasNoGenerics` (thanks to @isovector)\r\n* No need to keep referenced variables
  alive using annotations:\r\n  Simply mentioning them in a Template Haskell splice
  keeps them alive!\r\n\r\n## 0.2.0.1 -- 2018-02-02\r\n\r\n* Support GHC HEAD (8.5)\r\n\r\n##
  0.2 -- 2018-01-17\r\n\r\n* With `$(inspectTest obligation)` you can now get the
  result of inspection\r\n  testing at run-time, for integration into your test suite.\r\n\r\n##
  0.1.2 -- 2017-11-20\r\n\r\n* Make `(==-)` a bit more liberal, and look through variable
  redefinitions that\r\n  only change the type\r\n\r\n## 0.1.1.2 -- 2017-11-12\r\n\r\n*
  Hotfix: Do not abort if there are expected failures\r\n\r\n## 0.1.1.1 -- 2017-11-12\r\n\r\n*
  Show summary stats\r\n* Pull in less tests, to make inclusion in stackage easier\r\n\r\n##
  0.1.1 -- 2017-11-09\r\n\r\n* More complete output when `(===)` fails\r\n* Variant
  `(==-)` that ignores types when comparing terms\r\n\r\n## 0.1 -- 2017-11-09\r\n\r\n*
  Repackaged as inspection-testing\r\n\r\n## 0.1.1  -- 2017-09-05\r\n\r\n* Also run
  simplifier in stage 0\r\n\r\n## 0.1  -- 2017-08-26\r\n\r\n* Initial release to hackage\r\n\r\n##
  0  -- 2017-02-06\r\n\r\n* Development of ghc-proofs commences\r\n"
changelog-type: markdown
description: "Inspection Testing for Haskell\r\n==============================\r\n\r\nThis
  GHC plugin allows you to embed assertions about the intermediate code into\r\nyour
  Haskell code, and have them checked by GHC. This is called _inspection\r\ntesting_
  (as it automates what you do when you manually inspect the\r\nintermediate code).\r\n\r\nSynopsis\r\n--------\r\n\r\nSee
  the `Test.Inspection` module for the documentation, but there really isn't much\r\nmore
  to it than:\r\n\r\n```haskell\r\n{-# LANGUAGE TemplateHaskell #-}\r\nmodule Simple
  where\r\n\r\nimport Test.Inspection\r\nimport Data.Maybe\r\n\r\nlhs, rhs :: (a ->
  b) -> Maybe a -> Bool\r\nlhs f x = isNothing (fmap f x)\r\nrhs f Nothing = True\r\nrhs
  f (Just _) = False\r\n\r\ninspect $ 'lhs === 'rhs\r\n```\r\n\r\nIf you compile this,
  you will reassurringly read:\r\n\r\n```\r\n$ ghc Simple.hs\r\n[1 of 1] Compiling
  Simple           ( Simple.hs, Simple.o )\r\nexamples/Simple.hs:14:1: lhs === rhs
  passed.\r\ninspection testing successful\r\n      expected successes: 1\r\n```\r\n\r\nSee
  the [`examples/`](examples/) directory for more examples of working proofs.\r\n\r\nIf
  an assertion fails, for example\r\n\r\n```haskell\r\nbad1, bad2 :: Int\r\nbad1 =
  2 + 2\r\nbad2 = 5\r\n\r\ninspect $ 'bad1 === 'bad2\r\n```\r\nthen the compiler will
  tell you so, and abort the compilation:\r\n```\r\n$ ghc Simple.hs -dsuppress-idinfo\r\n[5
  of 5] Compiling Simple           ( examples/Simple.hs, examples/Simple.o )\r\nexamples/Simple.hs:14:1:
  lhs === rhs passed.\r\nexamples/Simple.hs:20:1: bad1 === bad2 failed:\r\n    LHS:\r\n
  \       bad1 :: Int\r\n        bad1 = I# 4#\r\n\r\n    RHS:\r\n        bad2 :: Int\r\n
  \       bad2 = I# 5#\r\n\r\n\r\nexamples/Simple.hs: error:\r\n    inspection testing
  unsuccessful\r\n          expected successes: 1\r\n         unexpected failures:
  1\r\n```\r\n\r\nWhat can I check for?\r\n---------------------\r\n\r\nCurrently,
  inspection-testing supports\r\n\r\n * checking two definitions to be equal (useful
  in the context of generic\r\n   programming)\r\n * checking the absence of a certain
  type (useful in the context of list or\r\n   stream fusion)\r\n * checking the absence
  of a a use of certian functions\r\n * checking the absence of allocation (generally
  useful)\r\n * checking the absence of typeclass-overloaded code\r\n\r\nIn general,
  the checks need to be placed in the same module as the\r\nchecked-definition.\r\n\r\nPossible
  further applications includes\r\n\r\n * checking that all recursive functions are
  (efficiently called) join-points\r\n * asserting strictness properties (e.g. in
  `Data.Map.Strict`)\r\n * peforming some of these checks only within recursive loops\r\n\r\nLet
  me know if you need any of these, or have further ideas.\r\n\r\nHelp, I am drowning
  in Core!\r\n----------------------------\r\n\r\ninspection-testing prints the Core
  more or less like GHC would, and the same\r\nflags can be used to control the level
  of detail. In particular, you might want\r\nto pass to GHC a selection of the following
  flags:\r\n\r\n    -dsuppress-idinfo -dsuppress-coercions -dsuppress-type-applications\r\n
  \   -dsuppress-module-prefixes -dsuppress-type-signatures -dsuppress-uniques\r\n\r\n\r\nIt
  does not seem to do anything (on GHC < 8.4)\r\n----------------------------------------------\r\n\r\nAdd
  this line to your module:\r\n\r\n    {-# OPTIONS_GHC -O -fplugin Test.Inspection.Plugin
  #-}\r\n\r\nCan I comment or help?\r\n----------------------\r\n\r\nSure! We can
  use the GitHub issue tracker for discussions, and obviously\r\ncontributions are
  welcome.\r\n\r\n"
description-type: markdown
hash: 6c274af2e286d1676a177f77618431521dac60c4c2882be80b864816d4b2836f
homepage: https://github.com/nomeata/inspection-testing
latest: 0.6.3
license-name: MIT
maintainer: mail@joachim-breitner.de
synopsis: GHC plugin to do inspection testing
test-bench-deps:
  base: '>=0'
  inspection-testing: '>=0'
