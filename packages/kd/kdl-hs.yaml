all-versions:
- 0.1.0
- 0.2.0
author: Brandon Chinn <brandonchinn178@gmail.com>
basic-deps:
  base: <5
  containers: '>=0'
  megaparsec: '>=0'
  prettyprinter: '>=1.7.0'
  scientific: '>=0'
  text: '>=0'
  transformers: '>=0'
changelog: |
  ## v0.2.0

  * Remove monad `Decoder` newtype, just give the `Monad` instance to the canonical `Decoder` type and use the same `Decoder` type everywhere
  * Reorganize module structure
  * Schema improvements
  * Rename `Decoder` => `DecodeArrow`, set `Decoder o a` as alias for `DecodeArrow o () a`
  * Use v2 syntax for `#true`/`#false`/`#null`

  ## v0.1.0

  Initial release, with:

  * Support for decoding v1 KDL syntax (and a subset of v2 KDL syntax)
  * Decoding via Arrows or Monads
  * Statically determine decoder schema
changelog-type: markdown
description: |
  # kdl-hs

  [![GitHub Actions](https://img.shields.io/github/actions/workflow/status/brandonchinn178/kdl-hs/ci.yml?branch=main)](https://github.com/brandonchinn178/kdl-hs/actions?query=branch%3Amain)
  [![](https://img.shields.io/hackage/v/kdl-hs)](https://hackage.haskell.org/package/kdl-hs)

  `kdl-hs` can parse and manage [KDL configuration files](https://kdl.dev).

  ## Quickstart

  Given a file `config.kdl`:

  ```kdl
  package {
    name my-pkg
    version "1.2.3"

    dependencies {
      aeson ">= 2.2.3.0" optional=#true
      text ">= 2"
    }
  }
  ```

  Parse it with `kdl-hs`:

  ```hs
  import KDL qualified

  main :: IO ()
  main = do
    config <- KDL.decodeFileWith decoder "config.kdl"
    print config

  decoder :: KDL.DocumentDecoder Config
  decoder = KDL.document $ do
    KDL.node "package"

  data Config = Config
    { name :: Text
    , version :: Text
    , dependencies :: Map Text Dep
    }
    deriving (Show)

  data Dep = Dep
    { version :: Text
    , optional :: Bool
    }
    deriving (Show)

  instance KDL.DecodeNode Config where
    nodeDecoder = do
      name <- KDL.argAt "name"
      version <- KDL.argAt "version"
      dependencies <- KDL.nodeWith "dependencies" . KDL.children $ KDL.remainingNodes
      pure Config{..}

  instance KDL.DecodeNode Dep where
    nodeDecoder = do
      version <- KDL.arg
      optional <- KDL.option False $ KDL.prop "optional"
      pure Dep{..}
  ```

  ## Acknowledgements

  * The KDL spec authors for devising a super cool configuration language
  * [kdl-rs](https://github.com/kdl-org/kdl-rs) for providing a guide for implementation
  * [hustle](https://github.com/fuzzypixelz/hustle) for the initial parser implementation that got me started.
description-type: markdown
hash: 4e2e021189b28a8720e94cc98652e0684f4ee2b494264fd095c45ea6d6645658
homepage: https://github.com/brandonchinn178/kdl-hs#readme
latest: 0.2.0
license-name: BSD-3-Clause
maintainer: Brandon Chinn <brandonchinn178@gmail.com>
synopsis: KDL language parser and API
test-bench-deps:
  base: '>=0'
  containers: '>=0'
  kdl-hs: '>=0'
  skeletest: '>=0'
  temporary: '>=0'
  text: '>=0'
