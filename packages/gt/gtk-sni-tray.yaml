all-versions:
- 0.1.0.0
- 0.1.1.0
- 0.1.2.0
- 0.1.2.1
- 0.1.3.0
- 0.1.3.1
- 0.1.3.2
- 0.1.4.0
- 0.1.5.0
- 0.1.6.0
- 0.1.6.2
- 0.1.7.0
- 0.1.8.0
- 0.1.8.1
- 0.1.9.0
- 0.1.9.1
- 0.1.10.0
- 0.1.10.1
- 0.1.10.2
- 0.1.10.3
- 0.1.11.0
- 0.1.11.1
- 0.1.11.2
- 0.1.11.3
author: Ivan Malison
basic-deps:
  base: '>=4.7 && <5'
  bytestring: '>=0.10 && <0.13'
  containers: '>=0.5 && <0.8'
  dbus: '>=1 && <2'
  dbus-hslogger: '>=0.1.0.1 && <0.2'
  directory: '>=1.2 && <1.4'
  enclosed-exceptions: '>=1.0.0.1 && <1.1'
  filepath: '>=1.3 && <1.6'
  gi-cairo: '>=1.0 && <1.1'
  gi-cairo-connector: '>=0.1 && <0.2'
  gi-cairo-render: '>=0.1 && <0.2'
  gi-dbusmenugtk3: '>=0.4 && <0.5'
  gi-gdk3: '>=3.0 && <3.1'
  gi-gdkpixbuf: '>=2.0.16 && <2.1'
  gi-glib: '>=2.0 && <2.1'
  gi-gtk-layer-shell: '>=0.1 && <0.2'
  gi-gtk3: '>=3.0 && <3.1'
  gtk-sni-tray: '>=0'
  gtk-strut: '>=0.1.4 && <0.2'
  haskell-gi: '>=0.21.2 && <0.27'
  haskell-gi-base: '>=0.21.1 && <0.27'
  hslogger: '>=1.2 && <1.4'
  optparse-applicative: '>=0.14 && <0.19'
  status-notifier-item: '>=0.3.2 && <0.4'
  template-haskell: '>=2.10 && <2.23'
  text: '>=1.2 && <2.2'
  transformers: '>=0.4 && <0.7'
  transformers-base: '>=0.4 && <0.5'
  unix: '>=2.7 && <2.9'
changelog: |
  # Changelog for gtk-sni-tray

  ## 0.1.11.3

  - Fix menu popup positioning: use `menuPopupAtPointer` with the actual button
    press event (via `getCurrentEvent`) so the menu appears at the click location
    instead of at an incorrect widget-relative position.

  ## 0.1.11.2

  - Add upper bounds to all dependencies per PVP.
  - Remove trailing zeros from dependency upper bounds.

  ## 0.1.11.1

  - Fix menu popups on Wayland/layer-shell: use `menuPopupAtWidget` instead of
    `menuPopupAtPointer` which fails with "no trigger event" when the GdkEvent's
    window is not a valid GDK surface.
  - Fix menu item clicks: defer menu widget destruction via `idleAdd` with
    `PRIORITY_LOW` so GTK's `activate` signal fires before the widget is destroyed.
  - Fix DBus Event variant wrapping: correctly double-wrap the data parameter
    to produce wire type `v` instead of `i`.
  - Send Event DBus calls on a forked thread to avoid blocking the GTK main loop.
  - Default menu backend to `HaskellDBusMenu` (pure Haskell implementation).
  - Deferred popup for `LibDBusMenu` backend to avoid assertion failures from
    showing the menu before the C library finishes loading the layout.

  ## 0.1.11.0

  - Restore `libdbusmenu` (`gi-dbusmenugtk3`) as the default menu backend.
  - Add runtime-configurable menu backend selection: `LibDBusMenu` (default) or
    `HaskellDBusMenu` via `trayMenuBackend` in `TrayParams` and `--menu-backend`
    CLI flag.

  ## 0.1.10.2

  - Fix menu popups not appearing: restore `widgetShowAll` so menu items are
    visible, and use `menuPopupAtPointer` for reliable positioning on both X11
    and Wayland.
  - Fix all `-Wall` warnings across library and executable.

  ## 0.1.10.1

  - Fix menu popup positioning on Wayland: use `menuAttachToWidget` instead of
    premature `widgetShowAll` so that `menuPopupAtWidget` can properly anchor the
    popup surface to the tray icon.

  ## 0.1.10.0

  - Replace `libdbusmenu` usage (`gi-dbusmenugtk3`) with a pure Haskell
    implementation of the `com.canonical.dbusmenu` protocol.
  - Add CSS style classes/names to tray menu widgets to make them themeable.

  ## 0.1.9.1

  - Fix type error with DM.Menu and Gtk.menuPopupAtWidget by adding explicit
    cast to Gtk.Menu. This fixes build failures with newer GI bindings where the
    type hierarchy is not automatically recognized.

  ## 0.1.9.0

  - Use the `gi-gtk3` and `gi-gdk3` build dependencies, which have been
    renamed from `gi-gtk` and `gi-gdk`.
changelog-type: markdown
description: |
  gtk-sni-tray
  ============
  ![Build Status](https://github.com/taffybar/gtk-sni-tray/actions/workflows/build.yml/badge.svg)
  [![Hackage](https://img.shields.io/hackage/v/gtk-sni-tray.svg?logo=haskell&label=gtk-sni-tray)](https://hackage.haskell.org/package/gtk-sni-tray) [![Stackage LTS](http://stackage.org/package/gtk-sni-tray/badge/lts)](http://stackage.org/lts/package/gtk-sni-tray) [![Stackage Nightly](http://stackage.org/package/gtk-sni-tray/badge/nightly)](http://stackage.org/nightly/package/gtk-sni-tray)

  gtk-sni-tray provides a [StatusNotifierHost](https://www.freedesktop.org/wiki/Specifications/StatusNotifierItem/StatusNotifierHost/) widget written using the gtk+3 bindings for haskell provided by [gi-gtk](https://hackage.haskell.org/package/gi-gtk). It also provides a simple standalone executable, `gtk-sni-tray-standalone`, that is configured with command line arguments. This executable will run the aforementioned widget by itself in a strut window on X11, or (when available) a layer-shell surface on Wayland.

  taffybar
  --------
  It is generally recommeneded that you use this widget through [taffybar](https://github.com/travitch/taffybar) with [this module](https://github.com/travitch/taffybar/blob/master/src/System/Taffybar/Widget/SNITray.hs), which will allow you to combine it with other useful widgets, and will allow more flexibility in configuration.

  StatusNotifierWatcher
  ---------------------
  By default, it is assumed that you are running an isolated StatusNotifierWatcher daemon. [status-notifier-item](https://github.com/IvanMalison/status-notifier-item) provides a StatusNotifierWatcher executable that you can use for this purpose. If you get an error like

  ```
  MethodError {methodErrorName = ErrorName "org.freedesktop.DBus.Error.ServiceUnknown", methodErrorSerial = Serial 7, methodErrorSender = Just (BusName "org.freedesktop.DBus"), methodErrorDestination = Just (BusName ":1.549"), methodErrorBody = [Variant "The name org.kde.StatusNotifierWatcher was not provided by any .service files"]}
  ```

  when you start `gtk-sni-tray-standalone` it is probably because you have not started a StatusNotifierWatcher on your system. You can solve this problem by passing the `--watcher` flag to `gtk-sni-tray-standalone`, but this is not recommeneded, because many SNI processes do not monitor for new watcher processes, and so may not immediately register when this new watcher is started.

  Installation
  ------------

  [`nix`](https://nixos.org/download.html),
  [`stack`](https://docs.haskellstack.org/en/stable/README/) and
  [`cabal`](https://www.haskell.org/cabal/download.html) can all be used to
  install gtk-sni-tray.

  When building with `cabal`, you will need the following system dependencies
  available via `pkg-config`:

  * `gtk+-3.0`
  * `gtk-layer-shell-0` (for the standalone Wayland layer-shell window)

  For Nix users, this repository provides a flake dev shell. If you use `direnv`,
  `direnv allow` then `direnv reload` should set up the environment.

  If you see a Cabal error about missing pkg-config packages, `scripts/cabal-run`
  does a quick preflight check and prints a more direct message.
description-type: markdown
hash: 2042e7ac2ff74859f0e747fa034710863f8f522ce3a4e55843909f34f05c01f9
homepage: https://github.com/IvanMalison/gtk-sni-tray#readme
latest: 0.1.11.3
license-name: BSD-3-Clause
maintainer: IvanMalison@gmail.com
synopsis: A standalone StatusNotifierItem/AppIndicator tray
test-bench-deps: {}
