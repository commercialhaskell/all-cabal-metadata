homepage: ''
changelog-type: markdown
hash: f1dca4cdd65b2fe4345142af77b79db6cf99f9f7f5e927316eee4f4063faf546
test-bench-deps:
  bytestring: -any
  base: -any
  hoauth2: -any
  text: -any
  hedgehog: -any
  binary: -any
  wai-middleware-auth: -any
maintainer: alexey@fpcomplete.com
synopsis: Authentication middleware that secures WAI application
changelog: |
  # 0.2.1.0
  ========

  * Fix a bug in deserialization of `UserIdentity`

  # 0.2.0.0
  ========

  * Drop compatiblity with hoauth2 versions <= 1.0.0.
  * Add a function for getting the oauth2 token from an authenticated request.
  * Modify encoding of oauth2 session cookies. As a consequence existing cookies will be invalid.

  0.1.2.1
  =======

  * Compatibility with hoauth2-1.3.0 - fixed: [#4](https://github.com/fpco/wai-middleware-auth/issues/4)

  0.1.2.0
  =======

  * Implemented compatibility with hoauth2 >= 1.0.0 - fixed: [#3](https://github.com/fpco/wai-middleware-auth/issues/3)

  0.1.1.2
  =======

  * Fixed [wai-middleware-auth-0.1.1.1 does not compile in 32 bit Linux](https://github.com/fpco/wai-middleware-auth/issues/2)

  0.1.1.1
  =======

  * Disallow empty `userIdentity` to produce a successfull login.
  * Produces a 404 on `/favicon.ico` page if not logged in: work around for issue
    with Chrome requesting it first and messing up the redirect url.
  * Added JQuery to the template, since it's bootstrap's requirement.

  0.1.1.0
  =======

  * Fixed whitelist email regex matching for Github and Google auth.

  0.1.0.0
  =======

  * Initial implementation.
basic-deps:
  shakespeare: -any
  warp: -any
  http-client: -any
  cookie: -any
  http-reverse-proxy: -any
  exceptions: -any
  cereal: -any
  bytestring: -any
  clientsession: -any
  wai: ! '>=3.0 && <4'
  case-insensitive: -any
  base: ! '>=4.7 && <5'
  hoauth2: ! '>=1.0'
  time: -any
  base64-bytestring: -any
  unordered-containers: -any
  text: -any
  safe-exceptions: -any
  unix-compat: -any
  uri-bytestring: -any
  blaze-builder: -any
  binary: -any
  vault: -any
  http-client-tls: -any
  regex-posix: -any
  optparse-simple: -any
  blaze-html: -any
  wai-extra: ! '>=3.0.7'
  wai-middleware-auth: -any
  http-conduit: -any
  http-types: -any
  wai-app-static: -any
  aeson: -any
  yaml: -any
all-versions:
- 0.1.0.0
- 0.1.1.0
- 0.1.1.1
- 0.1.1.2
- 0.1.2.0
- 0.1.2.1
- 0.2.0.0
- 0.2.1.0
author: Alexey Kuleshevich
latest: 0.2.1.0
description-type: markdown
description: |+
  # wai-middleware-auth

  Middleware that secures WAI application

  ## Installation

  ```shell
  $ stack install wai-middleware-auth
  ```
  OR
  ```shell
  $ cabal install wai-middleware-auth
  ```

  ## wai-auth

  Along with middleware this package ships with an executbale `wai-auth`, which
  can function as a protected file server or a reverse proxy. Right from the box
  it supports OAuth2 authentication as well as it's custom implementations for
  Google and Github.

  Configuration is done using a yaml config file. Here is a sample file that will
  configure `wai-auth` to run a file server with google and github authentication
  on `http://localhost:3000`:

  ```yaml
  app_root: "_env:APPROOT:http://localhost:3000"
  app_port: 3000
  cookie_age: 3600
  secret_key: "...+vwscbKR4DyPT"
  file_server:
    root_folder: "/path/to/html/files"
    redirect_to_index: true
    add_trailing_slash: true
  providers:
    github:
      client_id: "...94cc"
      client_secret: "...166f"
      app_name: "Dev App for wai-middleware-auth"
      email_white_list:
        - "^[a-zA-Z0-9._%+-]+@example.com$"
    google:
      client_id: "...qlj.apps.googleusercontent.com"
      client_secret: "...oxW"
      email_white_list:
        - "^[a-zA-Z0-9._%+-]+@example.com$"
  ```

  Above configuration will also block access to users that don't have an email
  with `example.com` domain. There is also a `secret_key` field which will be used
  to encrypt the session cookie. In order to generate a new random key run this command:

  ```shell
  $ echo $(wai-auth key --base64)
  azuCFq0zEBkLSXhQrhliZzZD8Kblo...
  ```

  Make sure you have proper callback/redirect urls registered with google/github
  apps, eg: `http://localhost:3000/_auth_middleware/google/complete`.

  After configuration file is ready, running application is very easy:

  ```shell
  $ wai-auth --config-file=/path/to/config.yaml
  Listening on port 3000
  ```

license-name: MIT
