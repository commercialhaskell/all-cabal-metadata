all-versions:
- '0.1'
- 0.1.0.1
- 0.1.0.2
- '0.2'
- 0.2.0.1
- 0.2.0.2
- 0.2.0.3
- '0.3'
- 0.3.1
- 0.3.1.1
- 0.3.1.2
- 0.3.1.3
- 0.3.1.4
- 0.3.1.5
- 0.3.1.6
- 0.3.1.7
- 0.3.1.8
- '0.4'
- '0.5'
- 0.5.0.1
author: Nikita Volkov <nikita.y.volkov@mail.ru>
basic-deps:
  base: '>=4.14 && <5'
  bytestring: '>=0.10 && <0.13'
  containers: '>=0.6 && <0.8'
  hasql: '>=1.10 && <1.11'
  hasql-implicits: '>=0.2.0.2 && <0.3'
  text: '>=1 && <3'
  text-builder: '>=1.0 && <1.1'
changelog: |
  # v0.5

  - (Breaking) Removed `Hasql.DynamicStatements.Session` module
  - (Breaking) Removed `Hasql.DynamicStatements.Statement` module
  - Added `toStatement`, `toSession`, `toPipeline` functions to the `Hasql.DynamicStatements.Snippet` module instead

  # v0.4

  - Migrated to Hasql 1.10
  - (Breaking) Redefined `Snippet.sql` to use `Text` instead of `ByteString`
  - (Breaking) Dropped the preparability flags assuming that all dynamic statements should not be
    prepared
changelog-type: markdown
description: "# hasql-dynamic-statements\n\n[![Hackage](https://img.shields.io/hackage/v/hasql-dynamic-statements.svg)](https://hackage.haskell.org/package/hasql-dynamic-statements)\n[![Continuous
  Haddock](https://img.shields.io/badge/haddock-master-blue)](https://nikita-volkov.github.io/hasql-dynamic-statements/)\n\nHasql
  extension for composable, dynamic construction of SQL statements.\n\n## Overview\n\nThis
  library provides a **Snippet** API that simplifies building SQL statements where
  the structure depends on runtime parameters. It abstracts over placeholder management
  and encoder matching, eliminating boilerplate and reducing bugs.\n\n## Key Features\n\n-
  **Composable**: Build statements using `Semigroup`/`Monoid` operations\n- **Type-safe**:
  Automatic parameter encoding with type-driven encoder derivation\n- **Dynamic**:
  Construct SQL conditionally based on parameters\n- **Clean API**: No manual placeholder
  numbering or encoder alignment\n\n## Quick Example\n\n```haskell\nimport Hasql.DynamicStatements.Snippet\n\n--
  Build a dynamic substring query\nselectSubstring :: Text -> Maybe Int32 -> Maybe
  Int32 -> Snippet\nselectSubstring string from to =\n  \"select substring(\" <> param
  string <>\n  foldMap (\\x -> \" from \" <> param x) from <>\n  foldMap (\\x -> \"
  for \" <> param x) to <>\n  \")\"\n\n-- Execute in a session\nresult <- toSession
  (selectSubstring \"hello\" (Just 2) Nothing) \n  (singleRow $ column $ nonNullable
  text)\n```\n\n## Without Snippet API\n\nCompare the above to manual construction:\n\n```haskell\nselectSubstring'
  :: Text -> Maybe Int32 -> Maybe Int32 -> Statement () Text\nselectSubstring' string
  from to = \n  let sql = case (from, to) of\n        (Just _, Just _)  -> \"select
  substring($1 from $2 to $3)\"\n        (Just _, Nothing) -> \"select substring($1
  from $2)\"\n        (Nothing, Just _) -> \"select substring($1 to $2)\"\n        (Nothing,
  Nothing) -> \"select substring($1)\"\n      encoder = \n        Encoders.param (string
  >$ Encoders.text) <>\n        foldMap (\\x -> Encoders.param (x >$ Encoders.int8))
  from <>\n        foldMap (\\x -> Encoders.param (x >$ Encoders.int8)) to\n      decoder
  = singleRow $ column $ nonNullable text\n  in Statement.preparable sql encoder decoder\n```\n\nThe
  Snippet API eliminates placeholder numbering, pattern matching on parameter presence,
  and manual encoder sequencing.\n\n## Core API\n\n### Construction\n\n- **`sql`**
  - Raw SQL text\n- **`param`** - Parameter with implicit encoder\n- **`encoderAndParam`**
  - Parameter with explicit encoder\n\n### Execution\n\n- **`toSql`** - Compile to
  SQL text with placeholders\n- **`toStatement`** - Create a `Statement`\n- **`toSession`**
  - Execute directly in `Session`\n- **`toPipeline`** - Execute in `Pipeline`\n"
description-type: markdown
hash: 0815ab545e3b705706c96941e3f55c7891dbb505b0fa537ef6f8264e4639870c
homepage: https://github.com/nikita-volkov/hasql-dynamic-statements
latest: 0.5.0.1
license-name: MIT
maintainer: Nikita Volkov <nikita.y.volkov@mail.ru>
synopsis: Hasql extension for dynamic construction of statements
test-bench-deps:
  hasql: '>=0'
  hasql-dynamic-statements: '>=0'
  hspec: ^>=2.11.12
  rerebase: <2
  testcontainers-postgresql: '>=0.2 && <0.3'
